<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixture - Torneo Squash 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #6B2439 0%, #4a1828 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #6B2439 0%, #4a1828 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav a {
            flex: 1;
            padding: 15px;
            text-align: center;
            text-decoration: none;
            color: #495057;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .nav a:hover, .nav a.active {
            background: white;
            color: #6B2439;
            border-bottom-color: #6B2439;
        }

        .content {
            padding: 30px;
        }

        .tier-section {
            margin-bottom: 30px;
        }

        .tier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #6B2439 0%, #4a1828 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .tier-header h2 {
            font-size: 1.5em;
        }

        .match-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .match-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .match-card.jugado {
            border-color: #28a745;
            background: #f8fff9;
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .match-info {
            font-size: 0.9em;
            color: #6c757d;
        }

        .match-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .match-status.pendiente {
            background: #fff3cd;
            color: #856404;
        }

        .match-status.jugado {
            background: #d4edda;
            color: #155724;
        }

        .players {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
        }

        .player {
            text-align: center;
        }

        .player-name {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .player-team {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .player-team.santi {
            background: #e3f2fd;
            color: #4a1828;
        }

        .player-team.lucas {
            background: #fce4ec;
            color: #d9a12a;
        }

        .vs {
            font-size: 1.5em;
            font-weight: 700;
            color: #6c757d;
        }

        .score {
            text-align: center;
            font-size: 2em;
            font-weight: 700;
            color: #28a745;
            margin: 15px 0;
        }

        .game-details {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .btn-generate {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 30px;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .container {
                border-radius: 0;
            }
            
            .players {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .vs {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Fixture del Torneo</h1>
            <p>Todos los partidos organizados por tier</p>
        </div>

        <div class="nav">
            <a href="index.html">Registro</a>
            <a href="fixture.html" class="active">Fixture</a>
            <a href="resultado.html">Resultados</a>
            <a href="tabla.html">Tabla</a>
        </div>

        <div class="content">
            <button class="btn-generate" onclick="generateMatches()">
                üé≤ Generar Partidos Autom√°ticamente
            </button>

            <div id="fixtureContainer"></div>
        </div>
    </div>

    <script>
        async function loadFixture() {
            try {
                const response = await fetch('/api/matches');
                const matches = await response.json();
                
                if (matches.length === 0) {
                    document.getElementById('fixtureContainer').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <h3>No hay partidos todav√≠a</h3>
                            <p>Haz clic en "Generar Partidos" para crear el fixture</p>
                        </div>
                    `;
                    return;
                }
                
                // Agrupar por tier
                const tiers = ['A', 'B', 'C', 'D'];
                let html = '';
                
                tiers.forEach(tier => {
                    const tierMatches = matches.filter(m => m.tier === tier);
                    if (tierMatches.length === 0) return;
                    
                    html += `
                        <div class="tier-section">
                            <div class="tier-header">
                                <h2>Tier ${tier}</h2>
                                <span>${tierMatches.length} partido(s)</span>
                            </div>
                    `;
                    
                    tierMatches.forEach(match => {
                        const statusClass = match.estado === 'jugado' ? 'jugado' : '';
                        const statusText = match.estado === 'jugado' ? 'Jugado' : 'Pendiente';
                        
                        html += `
                            <div class="match-card ${statusClass}">
                                <div class="match-header">
                                    <div class="match-info">
                                        ${match.fecha ? new Date(match.fecha).toLocaleDateString('es-AR') : 'Fecha por definir'}
                                        ${match.cancha ? ' - ' + match.cancha : ''}
                                    </div>
                                    <div class="match-status ${match.estado}">${statusText}</div>
                                </div>
                                
                                <div class="players">
                                    <div class="player">
                                        <div class="player-name">${match.jugador1}</div>
                                        <span class="player-team ${match.equipo1.toLowerCase()}">${match.equipo1}</span>
                                    </div>
                                    
                                    <div class="vs">VS</div>
                                    
                                    <div class="player">
                                        <div class="player-name">${match.jugador2}</div>
                                        <span class="player-team ${match.equipo2.toLowerCase()}">${match.equipo2}</span>
                                    </div>
                                </div>
                                
                                ${match.estado === 'jugado' ? `
                                    <div class="score">${match.games_ganados_p1} - ${match.games_ganados_p2}</div>
                                    <div style="text-align: center; color: #28a745; font-weight: 600;">
                                        Ganador: ${match.ganador}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                });
                
                document.getElementById('fixtureContainer').innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando fixture:', error);
                document.getElementById('fixtureContainer').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <h3>Error al cargar el fixture</h3>
                        <p>Intenta recargar la p√°gina</p>
                    </div>
                `;
            }
        }

        async function generateMatches() {
            if (!confirm('¬øGenerar partidos autom√°ticamente? Esto crear√° enfrentamientos para todos los jugadores registrados.')) {
                return;
            }
            
            try {
                const response = await fetch('/api/matches/generate', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert(`‚úÖ ${result.created} partidos creados exitosamente`);
                    loadFixture();
                } else {
                    alert('‚ùå ' + (result.error || 'Error al generar partidos'));
                }
            } catch (error) {
                alert('‚ùå Error de conexi√≥n');
                console.error('Error:', error);
            }
        }

        // Cargar fixture al inicio
        loadFixture();
        
        // Recargar cada 30 segundos
        setInterval(loadFixture, 30000);
    </script>
</body>
</html>
